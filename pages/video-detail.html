<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频列表 - UZIN优成</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">

        <!-- 类目标题 -->
        <div class="video-category-title">
            <h2>界面剂</h2>
        </div>

        <!-- 视频列表 -->
        <div class="video-list" id="video-list">
            <!-- 视频将通过JavaScript动态生成 -->
        </div>
    </div>

    <script>
        // 根据URL参数动态设置标题
        const urlParams = new URLSearchParams(window.location.search);
        const parentCategory = urlParams.get('parentCategory');
        const category = urlParams.get('category');

        // 加载JSON数据并生成页面内容
        async function loadData() {
            try {
                const response = await fetch('../data/data.json');
                const data = await response.json();

                // 找到对应的分类和子分类
                const categoryData = data.videoCategories.find(cat => cat.name === parentCategory);

                if (!categoryData) {
                    console.error('找不到父分类:', parentCategory);
                    return;
                }

                const subcategoryData = categoryData.subcategories.find(sub => sub.name === category);

                if (!subcategoryData) {
                    console.error('找不到子分类:', category);
                    return;
                }

                // 更新页面标题
                const titleElement = document.querySelector('.video-category-title h2');
                if (titleElement) {
                    titleElement.textContent = category;
                }
                document.title = category + ' - UZIN优成';

                // 生成视频列表
                const videoList = document.getElementById('video-list');
                const videos = subcategoryData.videos || [];

                if (videos.length === 0) {
                    videoList.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">暂无视频</p>';
                    return;
                }

                videos.forEach(video => {
                    const videoItem = document.createElement('div');
                    videoItem.className = `video-item ${video.orientation === 'vertical' ? 'vertical-video' : 'horizontal-video'}`;
                    videoItem.innerHTML = `
                        <div class="video-thumbnail">
                            <video data-src="${video.path}" preload="metadata"></video>
                            <div class="play-button">
                                <svg width="60" height="60" viewBox="0 0 60 60">
                                    <circle cx="30" cy="30" r="28" fill="rgba(0,0,0,0.6)" stroke="white" stroke-width="2"/>
                                    <polygon points="23,18 23,42 42,30" fill="white"/>
                                </svg>
                            </div>
                            <div class="video-progress-container">
                                <div class="progress-bar">
                                    <div class="progress-filled"></div>
                                    <div class="progress-handle"></div>
                                </div>
                                <div class="time-display">
                                    <span class="current-time">0:00</span>
                                    <span class="duration">0:00</span>
                                </div>
                            </div>
                            <div class="video-controls">
                                <button class="control-btn pause-btn" title="暂停">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                        <rect x="6" y="4" width="4" height="16"/>
                                        <rect x="14" y="4" width="4" height="16"/>
                                    </svg>
                                </button>
                                <div class="control-right">
                                    <button class="control-btn mute-btn" title="静音">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                                        </svg>
                                    </button>
                                    <button class="control-btn fullscreen-btn" title="全屏">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <h3>${video.title}</h3>
                    `;
                    videoList.appendChild(videoItem);
                });

                // 初始化视频播放功能
                initVideoPlayers();

            } catch (error) {
                console.error('加载数据失败:', error);
            }
        }

        // 初始化视频播放功能
        function initVideoPlayers() {
            document.querySelectorAll('.video-item').forEach(item => {
            const video = item.querySelector('video');
            const thumbnail = item.querySelector('.video-thumbnail');
            const playButton = item.querySelector('.play-button');
            const pauseBtn = item.querySelector('.pause-btn');
            const muteBtn = item.querySelector('.mute-btn');
            const fullscreenBtn = item.querySelector('.fullscreen-btn');
            const progressBar = item.querySelector('.progress-bar');
            const progressFilled = item.querySelector('.progress-filled');
            const progressHandle = item.querySelector('.progress-handle');
            const currentTimeDisplay = item.querySelector('.current-time');
            const durationDisplay = item.querySelector('.duration');

            // 初始化视频（加载第一帧作为封面）
            if (video.dataset.src) {
                video.src = video.dataset.src;
            }

            // 懒加载视频（已废弃，保留兼容性）
            function loadVideo() {
                // 视频已经在初始化时加载，此函数不再需要
                return;
            }

            // 视频加载错误处理
            video.addEventListener('error', function(e) {
                console.error('视频加载失败:', video.src, e);
                playButton.innerHTML = `
                    <div style="color: white; text-align: center; padding: 20px; background: rgba(0,0,0,0.6); border-radius: 10px; max-width: 250px;">
                        <p>视频加载失败</p>
                        <p style="font-size: 12px; margin-top: 8px;">文件: ${video.dataset.src}</p>
                        <p style="font-size: 12px; margin-top: 4px;">请检查文件是否存在</p>
                    </div>
                `;
                playButton.style.display = 'flex';
            });

            // 视频加载完成
            video.addEventListener('loadeddata', function() {
                console.log('视频加载成功:', video.src);
            });

            // 点击视频区域播放/暂停
            thumbnail.addEventListener('click', function(e) {
                // 如果点击的是控制按钮，不处理
                if (e.target.closest('.control-btn')) return;

                if (video.paused) {
                    // 暂停所有其他视频
                    document.querySelectorAll('video').forEach(v => {
                        if (v !== video) {
                            v.pause();
                            v.closest('.video-thumbnail').classList.remove('playing');
                        }
                    });

                    // 播放视频
                    video.play().catch(err => {
                        console.error('播放失败:', err);
                        alert('视频播放失败，请重试');
                    });
                } else {
                    video.pause();
                }
            });

            // 暂停/播放按钮
            pauseBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            });

            // 静音按钮
            muteBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                video.muted = !video.muted;
                updateMuteIcon();
            });

            // 全屏按钮
            fullscreenBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                if (!document.fullscreenElement) {
                    if (thumbnail.requestFullscreen) {
                        thumbnail.requestFullscreen();
                    } else if (thumbnail.webkitRequestFullscreen) {
                        thumbnail.webkitRequestFullscreen();
                    } else if (thumbnail.mozRequestFullScreen) {
                        thumbnail.mozRequestFullScreen();
                    } else if (thumbnail.msRequestFullscreen) {
                        thumbnail.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }
            });

            // 更新暂停按钮图标
            function updatePauseIcon() {
                if (video.paused) {
                    pauseBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <polygon points="8,5 8,19 19,12"/>
                    </svg>`;
                    pauseBtn.title = '播放';
                } else {
                    pauseBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <rect x="6" y="4" width="4" height="16"/>
                        <rect x="14" y="4" width="4" height="16"/>
                    </svg>`;
                    pauseBtn.title = '暂停';
                }
            }

            // 更新静音按钮图标
            function updateMuteIcon() {
                if (video.muted) {
                    muteBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
                    </svg>`;
                    muteBtn.title = '取消静音';
                } else {
                    muteBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                    </svg>`;
                    muteBtn.title = '静音';
                }
            }

            // 更新全屏按钮图标
            function updateFullscreenIcon() {
                if (document.fullscreenElement === thumbnail) {
                    fullscreenBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                    </svg>`;
                    fullscreenBtn.title = '退出全屏';
                } else {
                    fullscreenBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                    </svg>`;
                    fullscreenBtn.title = '全屏';
                }
            }

            // 格式化时间显示
            function formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            // 更新进度条
            function updateProgress() {
                const percent = (video.currentTime / video.duration) * 100 || 0;
                progressFilled.style.width = percent + '%';
                progressHandle.style.left = percent + '%';
                currentTimeDisplay.textContent = formatTime(video.currentTime);
            }

            // 进度条拖拽功能
            let isDragging = false;

            function seek(e) {
                const rect = progressBar.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                const seekTime = pos * video.duration;
                if (!isNaN(seekTime)) {
                    video.currentTime = seekTime;
                    updateProgress();
                }
            }

            progressBar.addEventListener('mousedown', function(e) {
                isDragging = true;
                seek(e);
            });

            document.addEventListener('mousemove', function(e) {
                if (isDragging) {
                    seek(e);
                }
            });

            document.addEventListener('mouseup', function() {
                isDragging = false;
            });

            progressBar.addEventListener('click', function(e) {
                if (!isDragging) {
                    seek(e);
                }
            });

            // 触摸设备支持
            progressBar.addEventListener('touchstart', function(e) {
                isDragging = true;
                const touch = e.touches[0];
                const rect = progressBar.getBoundingClientRect();
                const pos = (touch.clientX - rect.left) / rect.width;
                const seekTime = pos * video.duration;
                if (!isNaN(seekTime)) {
                    video.currentTime = seekTime;
                    updateProgress();
                }
            });

            progressBar.addEventListener('touchmove', function(e) {
                if (isDragging) {
                    const touch = e.touches[0];
                    const rect = progressBar.getBoundingClientRect();
                    const pos = (touch.clientX - rect.left) / rect.width;
                    const seekTime = pos * video.duration;
                    if (!isNaN(seekTime)) {
                        video.currentTime = seekTime;
                        updateProgress();
                    }
                }
            });

            progressBar.addEventListener('touchend', function() {
                isDragging = false;
            });

            // 视频事件监听
            video.addEventListener('play', function() {
                playButton.style.display = 'none';
                thumbnail.classList.add('playing');
                updatePauseIcon();
            });

            video.addEventListener('pause', function() {
                playButton.style.display = 'flex';
                thumbnail.classList.remove('playing');
                updatePauseIcon();
            });

            video.addEventListener('volumechange', function() {
                updateMuteIcon();
            });

            video.addEventListener('timeupdate', function() {
                updateProgress();
            });

            video.addEventListener('loadedmetadata', function() {
                durationDisplay.textContent = formatTime(video.duration);
                currentTimeDisplay.textContent = formatTime(0);
            });

            video.addEventListener('ended', function() {
                video.currentTime = 0;
                updateProgress();
            });

            // 全屏变化监听
            document.addEventListener('fullscreenchange', updateFullscreenIcon);
            document.addEventListener('webkitfullscreenchange', updateFullscreenIcon);
            document.addEventListener('mozfullscreenchange', updateFullscreenIcon);
            document.addEventListener('MSFullscreenChange', updateFullscreenIcon);
        });
        }

        // 页面加载时执行
        loadData();
    </script>
</body>
</html>
